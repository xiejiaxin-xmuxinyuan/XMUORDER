<cu-custom bgColor="bg-gradual-blue" isBack="{{true}}">
  <view slot="content">反馈</view>
</cu-custom>

<view wx:if="{{feedbacks.length > 0}}">
  <view wx:for="{{feedbacks}}" wx:key="_id">
    <scroll-view scroll-x class="bg-white nav">
    <view class="flex text-center">
      <view class="cu-item flex-sub {{item===stateCurr?'text-blue cur':''}}" wx:for="{{stateTypes}}" wx:key="*this" bindtap="stateTypeSelect" data-name="{{item}}">
        {{item}}
      </view>
    </view>
  </scroll-view>
    <view class="cu-card article ">
      <view class="cu-item shadow-warp myorder" wx:if="{{item.state == 1 && stateCurr === '已处理'}}">
        <view class="mycontent" data-index="{{index}}" catchtap="toRecoredDetail">
          <view wx:for="{{item.record}}" wx:for-item="i" wx:key="*this">
            <image class="cu-avatar lg" src="{{i.img}}" mode="aspectFill" lazy-load="{{true}}"></image>
            <view class="info">
              <view>
                <view class="text-cut text-bold">{{i.food}}</view>
                <view class="text-bold">￥{{i.price}}</view>
              </view>
              <view class="text-gray">
                <view>{{i.num}}件</view>
                <view>×{{i.num}}</view>
              </view>
            </view>
          </view>
        </view>
        <view class="my-bottom">
          <view class="info">
            <view class="cu-tag bg-brown light lg round">{{'反馈时间：' + item.date}}</view>
            <view class="text-bold text-black text-right">
              合计：<text class="text-red"> ￥{{i.num*i.price}}</text>
            </view>
          </view>
        </view>
        <view>
          <text>用户反馈：{{item.feedback}}</text>
        </view>
        <view>
          <view wx:if="{{item.refund}}" class="cu-btn bg-red round shadow">
            <text class="text-bold">申请退款</text>
          </view>
          <view wx:else class="cu-btn bg-green round shadow">
            <text class="text-bold">未申请退款</text>
          </view>
          <view class="cu-btn bg-blue round shadow">
            <text class="text-bold">已处理</text>
          </view>
        </view>
      </view>
      <view class="cu-item shadow-warp myorder" wx:if="{{item.state == 0 && stateCurr === '未处理'}}">
        <view class="mycontent" data-index="{{index}}" catchtap="toRecoredDetail">
          <view wx:for="{{item.record}}" wx:for-item="i" wx:key="*this">
            <image class="cu-avatar lg" src="{{i.img}}" mode="aspectFill" lazy-load="{{true}}"></image>
            <view class="info">
              <view>
                <view class="text-cut text-bold">{{i.food}}</view>
                <view class="text-bold">￥{{i.price}}</view>
              </view>
              <view class="text-gray">
                <view>{{i.num}}件</view>
                <view>×{{i.num}}</view>
              </view>
            </view>
          </view>
        </view>
        <view class="my-bottom">
          <view class="info">
            <view class="cu-tag bg-brown light lg round">{{'反馈时间：' + item.date}}</view>
            <view class="text-bold text-black text-right">
              合计：<text class="text-red"> ￥{{i.num*i.price}}</text>
            </view>
          </view>
        </view>
        <view>
          <text>用户反馈：{{item.feedback}}</text>
        </view>
        <view>
          <view wx:if="{{item.refund}}" class="cu-btn bg-red round shadow">
            <text class="text-bold">申请退款</text>
          </view>
          <view wx:else class="cu-btn bg-green round shadow">
            <text class="text-bold">未申请退款</text>
          </view>
          <view class="cu-btn bg-yellow round shadow" catchtap="dealFeedback" data-index="{{index}}" wx:if="{{item.state === 0}}">
            <text class="text-bold">处理</text>
          </view>
        </view>
      </view>
    </view>
  </view>
</view>
<view class="no-record text-gray" wx:else>
  <view class="cuIcon-form"></view>
  暂无反馈
</view>

<view class="my-bar">
  <block wx:if="{{feedbackTotalPage > 1 && feedbacks.length}}">
    <view class="page-bar">
      <button catchtap="feedbackChangePage" class="cu-btn line-black  round shadow">上一页</button>
      <text class="text-lg margin-sm">{{feedbackCurrPage}} / {{feedbackTotalPage}}</text>
      <button catchtap="feedbackChangePage" data-add="{{true}}" class="cu-btn line-black  round shadow">下一页</button>
    </view>
  </block>
</view>

<view class="footer">
  <view class="text-grey padding">Copyright © 2021 厦门大学智能点餐项目组</view>
</view>